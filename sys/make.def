#---------------------------------------------------------------------------
#
#                SITE- AND/OR PLATFORM-SPECIFIC DEFINITIONS. 
#
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# Items in this file will need to be changed for each platform.
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
#
# CC/CXX         - C/C++ compiler 
# CFLAGS/CXXFLAG     - C/C++ compilation arguments
# C_INC/CXX_INC      - any -I arguments required for compiling C/C++
# CLINK/CXXLINK     - C/C++ linker
# CLINKFLAGS/CXXLINKFLAGS - C/C++ linker flags
# C_LIB/CXX_LIB      - any -L and -l arguments required for linking C/C++ 
#
# For C compilations are done with $(CC) $(C_INC) $(CFLAGS) or
#                            $(CC) $(CFLAGS)
# linking is done with       $(CLINK) $(C_LIB) $(CLINKFLAGS)
#
# For C++ compilations are done with $(CXX) $(CXX_INC) $(CXXFLAGS) or
#                            $(CXX) $(CXXFLAGS)
# linking is done with       $(CXXLINK) $(CXX_LIB) $(CXXLINKFLAGS)
#---------------------------------------------------------------------------

#---------------------------------------------------------------------------
# CUDA Module 
#---------------------------------------------------------------------------
#---------------------------------------------------------------------------
# C compilers
#---------------------------------------------------------------------------
CCOMPILERS="cc, clang, gcc, xlc"
JSRUN_COMMAND = jsrun -n 1 -g 4 -a 1 
APRUN_COMMAND = aprun -n 1 -d 1 

# CRAY compiler
ifeq ($(CC), cc)
  CFLAGS = -homp -O3
  CLINK = cc
  CLINKFLAGS = -homp -lm
  C_COMPILER_MODULE = PrgEnv-cray cce/8.6.5 craype-accel-nvidia35 cudatoolkit craype/2.5.13 cray-mpich/7.7.0
  CUDA_MODULE = cudatoolkit
  BATCH_SCHEDULER = $(APRUN_COMMAND)
endif

# GCC compiler
ifeq ($(CC), gcc)
  COFFLOADING = -foffload="-lm" -lm
  C_NO_OFFLOADING = -foffload=disable
  CFLAGS = -O3 -std=c99 -fopenmp $(COFFLOADING) 
  CLINK = gcc
  CLINKFLAGS = -O3 -fopenmp $(COFFLOADING)
  CUDA_MODULE = cuda/8.0.61-1
  C_COMPILER_MODULE = gcc/7.1.1-20170802
  BATCH_SCHEDULER = $(JSRUN_COMMAND)
endif

# IBM XL compiler
ifeq ($(CC), xlc)
  COFFLOADING = -qoffload
  C_NO_OFFLOADING = 
  CFLAGS = -O3 -qsmp=omp $(COFFLOADING)
  CLINK = xlc
  CLINKFLAGS = -O3 -qsmp=omp $(COFFLOADING)
  CUDA_MODULE = cuda/8.0.61-1
  C_COMPILER_MODULE = xl/20180125
  BATCH_SCHEDULER = $(JSRUN_COMMAND)
endif

# Clang compiler
ifeq ($(CC), clang)
  COFFLOADING = -fopenmp-targets=nvptx64-nvida-cuda
  C_NO_OFFLOADING = 
  CFLAGS = -O3 -std=c99 -fopenmp $(COFFLOADING)
  CLINK = clang
  CLINKFLAGS = -O3 -fopenmp $(COFFLOADING)
  CUDA_MODULE = cuda/8.0.61-1
  C_COMPILER_MODULE = clang/20170925
  BATCH_SCHEDULER = $(JSRUN_COMMAND)
endif

#---------------------------------------------------------------------------
# C++ compilers
#---------------------------------------------------------------------------
CXXCOMPILERS="clang++, g++, xlc++"

# CRAY compiler
ifeq ($(CC), CC)
  CFLAGS = -homp -O3
  CLINK = cc
  CLINKFLAGS = -homp -lm
  C_COMPILER_MODULE = PrgEnv-cray cce/8.6.5 craype-accel-nvidia35 craype/2.5.13 cray-mpich/7.7.0
  CUDA_MODULE = cudatoolkit
  BATCH_SCHEDULER = $(APRUN_COMMAND)
endif

# GCC compiler
ifeq ($(CXX), g++)
  CXXOFFLOADING = -foffload="-lm" -lm
  CXX_NO_OFFLOADING = -foffload=disable
  CXXFLAGS = -O3 -fopenmp $(CXXOFFLOADING)
  CXXLINK = g++
  CXXLINKFLAGS = -O3 -fopenmp $(CXXOFFLOADING)
  CXX_COMPILER_MODULE = gcc/7.1.1-20170802
  CUDA_MODULE = cuda/8.0.61-1
  BATCH_SCHEDULER = $(JSRUN_COMMAND)
endif

# IBM XL compiler
ifeq ($(CXX), xlc++)
  CXXOFFLOADING = -qoffload
  CXX_NO_OFFLOADING = 
  CXXFLAGS = -O3 -qsmp=omp $(CXXOFFLOADING)
  CXXLINK = xlc++
  CXXLINKFLAGS = -O3 -qsmp=omp $(CXXOFFLOADING)
  CXX_COMPILER_MODULE = xl/20180125
  CUDA_MODULE = cuda/8.0.61-1
  BATCH_SCHEDULER = $(JSRUN_COMMAND)
endif

# Clang compiler
ifeq ($(CXX), clang++)
  CXXOFFLOADING = -fopenmp-targets=nvptx64-nvida-cuda 
  CXX_NO_OFFLOADING = 
  CXXFLAGS = -O3 -fopenmp $(CXXOFFLOADING) 
  CXXLINK = clang++
  CXXLINKFLAGS = -O3 -fopenmp $(CXXOFFLOADING)
  CXX_COMPILER_MODULE = clang/20170925
  CUDA_MODULE = cuda/8.0.61-1
  BATCH_SCHEDULER = $(JSRUN_COMMAND)
endif

#---------------------------------------------------------------------------
# These macros are passed to the linker 
#---------------------------------------------------------------------------
C_LIB  = 
CXX_LIB  = 

#---------------------------------------------------------------------------
# These macros are passed to the compiler 
#---------------------------------------------------------------------------
C_INC = -I./ompvv
CXX_INC = -I./ompvv

#---------------------------------------------------------------------------
# Destination of executables, relative to subdirs of the main directory. . 
#---------------------------------------------------------------------------
BINDIR = bin

#---------------------------------------------------------------------------
# COMPILER DEF
#---------------------------------------------------------------------------
CCOMPILE = $(CC) $(C_INC) $(CFLAGS)
CXXCOMPILE = $(CXX) $(CXX_INC) $(CXXFLAGS)

#---------------------------------------------------------------------------
# COLORS DEF
#---------------------------------------------------------------------------
TXTBLK := "\033[0;30m" # Black - Regular
TXTRED := "\033[0;31m" # Red
TXTGRN := "\033[0;32m" # Green
TXTYLW := "\033[0;33m" # Yellow
TXTBLU := "\033[0;34m" # Blue
TXTPUR := "\033[0;35m" # Purple
TXTCYN := "\033[0;36m" # Cyan
TXTWHT := "\033[0;37m" # White
TXTNOC := "\033[0m"

#---------------------------------------------------------------------------
# LOGS
#---------------------------------------------------------------------------
LOGTEMPFILE := _ompvv_temp_result_.exitstatus
